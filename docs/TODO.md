# K-Reader 开发待办清单

> 更新时间: 2026-02-05
> 当前阶段: 第三阶段 - 书库与批注功能开发 (87%)

## 🔥 当前冲刺 (Sprint 2: Week 2-3)

### 本周目标：完成核心阅读功能

#### 高优先级 (P0) - 已完成
- [x] 安装和配置 epub.js
- [x] 创建 EpubReader 服务类
- [x] 实现书籍文件选择和导入
- [x] 实现 EPUB 文件解析
- [x] 实现基础渲染显示
- [x] 实现翻页功能 (上一页/下一页)

#### 中优先级 (P1) - 已完成
- [x] 实现文件操作 IPC 处理器
- [x] 实现书籍元数据提取
- [x] 实现封面图片提取
- [x] 书库页面显示书籍列表
- [x] 点击书籍进入阅读器

#### 新增功能 (2026-02-05) - 已完成
- [x] 快速跳转功能
- [x] 搜索功能
- [x] 全屏模式
- [x] 翻页动画效果
- [x] 高亮批注功能
- [x] 设置页面

---

## 📝 详细任务清单

### 阶段二：核心阅读功能 (28/28) ✅

#### 1. EPUB 引擎集成 (7/7) ✅
- [x] 1.1 安装 epub.js 和类型定义
- [x] 1.2 创建 `src/renderer/src/modules/reader/services/EpubReader.ts`
- [x] 1.3 实现 `EpubReader` 类的基础方法
  - [x] `init()` - 初始化书籍
  - [x] `display()` - 显示内容
  - [x] `next()` - 下一页
  - [x] `prev()` - 上一页
  - [x] `destroy()` - 销毁实例
- [x] 1.4 创建 `EpubViewer` 组件
- [x] 1.5 集成到 Reader 页面
- [x] 1.6 测试基础渲染功能
- [x] 1.7 处理边界情况和错误

#### 2. 文件操作实现 (7/7) ✅
- [x] 2.1 实现 `FileHandlers.select()` - 文件选择对话框
- [x] 2.2 实现 `FileHandlers.read()` - 文件读取
- [x] 2.3 实现 `FileHandlers.write()` - 文件写入
- [x] 2.4 实现 `FileHandlers.exists()` - 文件存在检查
- [x] 2.5 实现 `FileHandlers.getInfo()` - 获取文件信息
- [x] 2.6 实现 `FileHandlers.delete()` - 删除文件
- [x] 2.7 添加拖拽文件支持 (待测试)

#### 3. 书籍管理 (8/8) ✅
- [x] 3.1 实现 `BookHandlers.import()` - 书籍导入
- [x] 3.2 实现 `BookHandlers.extractMetadata()` - 元数据提取
- [x] 3.3 实现 `BookHandlers.extractCover()` - 封面提取
- [x] 3.4 实现 `BookHandlers.getAll()` - 获取所有书籍
- [x] 3.5 实现 `BookHandlers.get()` - 获取单本书籍
- [x] 3.6 实现 `BookHandlers.update()` - 更新书籍
- [x] 3.7 实现 `BookHandlers.delete()` - 删除书籍
- [x] 3.8 实现 `BookHandlers.search()` - 搜索书籍

#### 4. 书库 UI (6/6) ✅
- [x] 4.1 创建 `BookCard` 组件 - 书籍卡片
- [x] 4.2 创建 `BookGrid` 组件 - 网格视图
- [x] 4.3 创建 `ImportButton` 组件 - 导入按钮
- [x] 4.4 使用 useQuery 获取书籍列表
- [x] 4.5 实现书籍点击跳转阅读器
- [x] 4.6 添加空状态提示

#### 5. 阅读进度 (5/5) ✅
- [x] 5.1 实现 `ProgressHandlers.save()` - 保存进度
- [x] 5.2 实现 `ProgressHandlers.get()` - 获取进度
- [x] 5.3 实现 `ProgressHandlers.addTime()` - 添加时长
- [x] 5.4 实现自动保存
- [x] 5.5 实现进度恢复

#### 6. 阅读器界面优化 (8/8) ✅
- [x] 6.1 工具栏实现
- [x] 6.2 字体设置
- [x] 6.3 主题切换
- [x] 6.4 翻页动画
- [x] 6.5 目录和导航
- [x] 6.6 进度条显示
- [x] 6.7 键盘导航
- [x] 6.8 全屏模式

#### 7. 快速跳转 (3/3) ✅ (2026-02-05)
- [x] 7.1 实现按进度跳转
- [x] 7.2 实现按章节跳转
- [x] 7.3 添加跳转按钮和 UI

#### 8. 搜索功能 (4/4) ✅ (2026-02-05)
- [x] 8.1 实现搜索服务方法
- [x] 8.2 添加搜索按钮和输入框
- [x] 8.3 实现搜索结果导航
- [x] 8.4 实现搜索结果高亮

#### 9. 高亮批注 (8/8) ✅ (2026-02-05)
- [x] 9.1 实现文本选择检测
- [x] 9.2 实现高亮标记
- [x] 9.3 实现批注创建
- [x] 9.4 实现批注保存
- [x] 9.5 实现批注菜单 UI
- [x] 9.6 实现批注渲染（在阅读器中显示已保存的批注）
- [x] 9.7 实现批注列表
- [x] 9.8 实现批注导出

#### 10. 设置页面 (5/5) ✅ (2026-02-05)
- [x] 10.1 创建设置页面组件
- [x] 10.2 实现阅读器默认设置
- [x] 10.3 实现自动保存设置
- [x] 10.4 实现书库显示设置
- [x] 10.5 实现快捷键说明

---

### 阶段三：书库与批注 (20/23)

#### 11. 批注系统增强 (5/5) ✅
- [x] 11.1 实现批注列表查看
- [x] 11.2 实现批注编辑功能
- [x] 11.3 实现批注删除功能
- [x] 11.4 实现批注导出（Markdown/JSON）
- [x] 11.5 实现批注在阅读器中的渲染

#### 12. 书库管理增强 (11/12) ✅
- [x] 12.1 实现标签管理 ✨ (2026-02-05)
- [ ] 12.2 实现书架功能
- [x] 12.3 实现书籍搜索功能
- [x] 12.4 实现筛选功能
- [x] 12.5 实现排序功能
- [x] 12.6 实现列表视图模式
- [x] 12.7 实现详情视图
- [ ] 12.8 实现批量操作
- [x] 12.9 实现书籍编辑
- [x] 12.10 实现书籍删除确认

---

### 阶段四：云同步服务 (0/18)

#### 13. 后端 API (待定)
- [ ] 13.1 用户认证
- [ ] 13.2 数据同步接口
- [ ] 13.3 文件存储
- [ ] 13.4 冲突解决

#### 14. 前端同步 (0/14)
- [ ] 14.1 实现同步队列
- [ ] 14.2 实现离线队列
- [ ] 14.3 实现冲突检测
- [ ] 14.4 实现冲突解决 UI
- [ ] 14.5 实现同步状态显示
- [ ] 14.6 实现网络状态检测
- [ ] 14.7 实现自动同步
- [ ] 14.8 实现手动同步
- [ ] 14.9 实现选择性同步
- [ ] 14.10 实现同步设置
- [ ] 14.11 书籍同步
- [ ] 14.12 批注同步
- [ ] 14.13 进度同步
- [ ] 14.14 设置同步

---

### 阶段五：智能服务集成 (0/28)

#### 15. AI 助手 (0/10)
- [ ] 15.1 集成 OpenAI API
- [ ] 15.2 实现上下文提取
- [ ] 15.3 实现智能摘要
- [ ] 15.4 实现内容解释
- [ ] 15.5 实现问答对话
- [ ] 15.6 实现流式响应
- [ ] 15.7 创建 AI 对话 UI
- [ ] 15.8 实现对话历史
- [ ] 15.9 实现 AI 设置
- [ ] 15.10 实现缓存优化

#### 16. TTS 语音朗读 (0/8)
- [ ] 16.1 集成系统 TTS API
- [ ] 16.2 实现播放控制
- [ ] 16.3 实现语速控制
- [ ] 16.4 实现音量控制
- [ ] 16.5 实现连续朗读
- [ ] 16.6 实现自动翻页
- [ ] 16.7 创建 TTS 播放器 UI
- [ ] 16.8 实现语音设置

#### 17. 翻译和词典 (0/10)
- [ ] 17.1 实现文本选择检测
- [ ] 17.2 集成翻译 API
- [ ] 17.3 实现翻译弹窗
- [ ] 17.4 实现离线词典
- [ ] 17.5 实现翻译缓存
- [ ] 17.6 实现生词本
- [ ] 17.7 实现翻译历史
- [ ] 17.8 实现多翻译源
- [ ] 17.9 创建翻译 UI
- [ ] 17.10 实现翻译设置

---

### 阶段六：优化与打磨 (0/24)

#### 18. 性能优化 (0/8)
- [ ] 18.1 虚拟化书籍列表
- [ ] 18.2 图片懒加载
- [ ] 18.3 组件懒加载
- [ ] 18.4 使用 React.memo
- [ ] 18.5 大文件流式读取
- [ ] 18.6 Web Worker 优化
- [ ] 18.7 缓存策略优化
- [ ] 18.8 启动速度优化

#### 19. UI/UX 优化 (0/8)
- [ ] 19.1 实现快捷键系统
- [ ] 19.2 添加页面过渡动画
- [ ] 19.3 添加加载动画
- [ ] 19.4 优化错误提示
- [ ] 19.5 实现响应式布局
- [ ] 19.6 无障碍支持
- [ ] 19.7 暗色模式优化
- [ ] 19.8 多语言支持

#### 20. 测试 (0/8)
- [ ] 20.1 编写单元测试
- [ ] 20.2 编写集成测试
- [ ] 20.3 编写 E2E 测试
- [ ] 20.4 跨平台测试 (Windows)
- [ ] 20.5 跨平台测试 (macOS)
- [ ] 20.6 跨平台测试 (Linux)
- [ ] 20.7 性能测试
- [ ] 20.8 Bug 修复

---

### 阶段七：打包发布 (0/7)

#### 21. 打包配置 (0/4)
- [ ] 21.1 配置 electron-builder
- [ ] 21.2 配置应用图标
- [ ] 21.3 配置代码签名
- [ ] 21.4 配置自动更新

#### 22. 发布准备 (0/3)
- [ ] 22.1 编写用户文档
- [ ] 22.2 制作宣传材料
- [ ] 22.3 准备发布渠道

---

## 🎯 本月目标 (2026-02)

### 第 1 周 (2/4 - 2/10)
- [x] 基础框架搭建
- [x] EPUB 引擎集成
- [x] 文件操作实现

### 第 2 周 (2/11 - 2/17)
- [x] 书籍管理功能
- [x] 书库 UI 实现
- [x] 阅读进度保存
- [x] 阅读器界面优化

### 第 3 周 (2/18 - 2/24)
- [x] 快速跳转功能
- [x] 搜索功能
- [x] 全屏模式
- [x] 翻页动画
- [x] 高亮批注
- [x] 设置页面

### 第 4 周 (2/25 - 3/3)
- [x] 批注系统增强
- [x] 标签管理功能 ✨ (2026-02-05)
- [x] 书库管理增强
- [ ] 测试和优化
- [ ] Bug 修复

---

## 📌 重要提醒

### 开发顺序建议
1. **先实现核心功能**：阅读器 > 书库 > 批注
2. **再实现增强功能**：云同步 > AI > TTS > 翻译
3. **最后优化打磨**：性能 > UI/UX > 测试

### 技术债务
- [ ] 完善错误处理
- [ ] 添加日志系统
- [ ] 优化类型定义
- [ ] 添加单元测试
- [ ] 编写 API 文档

### 待决策事项
- [ ] 是否支持 PDF 格式
- [ ] 云同步服务提供商选择
- [ ] AI 服务提供商选择
- [ ] 是否开源

---

## 🔗 快速链接

- [进度文档](PROGRESS.md) - 详细进度
- [项目结构](PROJECT_STRUCTURE.md) - 代码结构
- [设计文档](design.md) - 设计规范
- [开发计划](../plan.md) - 长期计划

---

**最后更新**: 2026-02-05
**下次审查**: 完成批注系统增强后
